---
title: Redux Toolkit íŠœí† ë¦¬ì–¼ (3)
date: 2023-08-06
description:
thumbnail: /imgs/posts/11/redux.png
keywords:
  - redux
  - ìƒíƒœ ê´€ë¦¬
---

![redux](/imgs/posts/11/redux.png)
[https://ko.redux.js.org](https://ko.redux.js.org)

ë³¸ê²©ì ìœ¼ë¡œ redux toolkitì„ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•œ sns ì•±ì„ ë§Œë“¤ì–´ë³´ì.  
reduxì™€ redux toolkitì„ ë¨¼ì € ì„¤ì¹˜í•œë‹¤. ì½”ë”© í™˜ê²½ì€ Reactì™€ Typescriptë¥¼ ì‚¬ìš©í–ˆë‹¤. ìŠ¤íƒ€ì¼ë§ì€ tailwindë¥¼ ì‚¬ìš©í–ˆë‹¤.

```html
npm i @reduxjs/toolkit react-redux
```

## PostsReducer

`features/postsSlice.ts`ë¥¼ ë§Œë“¤ì–´ sliceë¥¼ ìƒì„±í•œë‹¤. ë˜í•œ `initialState`ë¥¼ ìƒì„±í•˜ì—¬ ë”ë¯¸ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤. `reducers`ëŠ” ë¹„ì–´ìˆëŠ” ìƒíƒœë‹¤.

```ts
// features/postsSlice.ts
import { createSlice } from '@reduxjs/toolkit';

const initialState: Post[] = [
  {
    id: '1',
    title:
      'sunt aut facere repellat provident occaecati excepturi optio reprehenderit',
    content:
      'quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"',
  },
  {
    id: '2',
    title: 'qui est esse',
    content:
      'est rerum tempore vitae\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\nqui aperiam non debitis possimus qui neque nisi nulla',
  },
];

const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {},
});

export default postsSlice.reducer;
```

`app/store.ts`ì—ì„œ `configureStore`ë¥¼ ì´ìš©í•´ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•œ í›„ì— `postsSlice`ë¥¼ posts ë¦¬ë“€ì„œì— ì¶”ê°€í•œë‹¤. `useSelector`ë¥¼ í†µí•´ `state.posts`ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

```ts
// app/store.ts
import { configureStore } from '@reduxjs/toolkit';
import postsSlice from 'features/postsSlice';

export const store = configureStore({
  reducer: { posts: postsSlice },
});

export type RootState = ReturnType<typeof store.getState>;

export type AppDispatch = typeof store.dispatch;
```

ì´ì œ ë¸Œë¼ìš°ì €ì—ì„œ `Redux DevTools Extension`ì„ í†µí•´ posts ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![ìº¡ì²˜ !!500](/imgs/posts/10/aed2382c-6566-4c93-b33a-e73ebd79f0bb.png)

ì§€ê¸ˆê¹Œì§€ ë Œë”ë§ í™”ë©´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
![ìº¡ì²˜ !!500](/imgs/posts/10/7dd36e16-4d77-4397-9251-9edd095831d2.png)

postsSliceì—ì„œ ê²Œì‹œê¸€ ë“±ë¡ ë¦¬ë“€ì„œ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤. postAdded í•¨ìˆ˜ëŠ” stateì™€ action ë‘ ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ê³  `action.payload`ì—ëŠ” postì˜ ì •ë³´ê°€ ì „ë‹¬ëœë‹¤. `createSlice` ì•ˆì—ì„œ pushë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶ˆë³€ì„±ì„ ì§€í‚¤ì§€ ì•Šì•„ë„ ë˜ëŠ” ì´ìœ ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ immer ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ë¶ˆë³€ì„±ì„ ì§€í‚¤ê¸° ë•Œë¬¸ì´ë‹¤.

```ts {7-9, 13}
// features/postsSlice.ts
// ì½”ë“œ ìƒëµ
const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    postAdded(state, action: PayloadAction<Post>) {
      state.push(action.payload);
    },
  },
});

export const { postAdded } = postsSlice.actions;
```

`postAdded` ì•¡ì…˜ì„ export í•˜ì—¬ ì™¸ë¶€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤. ì´ì œ `PostForm` ì»´í¬ë„ŒíŠ¸ë¡œ ëŒì•„ê°€ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— postAdded ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€ì‹œí‚¨ë‹¤.

### nanoid

```tsx {2-3, 10-14}
// ì½”ë“œ ìƒëµ
import { nanoid } from '@reduxjs/toolkit';
import { postAdded } from 'features/postsSlice';

export default function PostForm() {
  // ì½”ë“œ ìƒëµ

  const handlePostSave = (e: React.FormEvent) => {
    e.preventDefault();
    if (title && content) {
      dispatch(postAdded({ id: nanoid(), title, content }));
      setTitle('');
      setContent('');
    }
  };
  // ì½”ë“œ ìƒëµ
}
```

ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” `id`ê°’ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ë˜ì§€ë§Œ í˜„ì¬ëŠ” ë¡œì»¬ ìƒíƒœì´ë¯€ë¡œ `id` ê°’ì„ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤. redux toolkitì˜ nanoidëŠ” ìœ ë‹ˆí¬í•œ ê°’ì„ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— nanoidë¥¼ ì‚¬ìš©í•˜ì—¬ `id`ê°’ì„ ì¶”ê°€í•˜ì˜€ë‹¤.

![ìº¡ì²˜ !!500](/imgs/posts/10/a5b1cfe8-3d8b-45b2-b75a-407534a8b29f.png)

ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ `posts/postAdded` ì•¡ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ë””ìŠ¤íŒ¨ì¹˜ë˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`SinglePostPage` ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒì„±í•˜ê³  `useParams`ë¥¼ ì´ìš©í•´ postIdë¥¼ ë°›ëŠ”ë‹¤. `useAppSelector`ì—ì„œ `Array.find`ë¥¼ ì´ìš©í•˜ì—¬ postIdì™€ ì¼ì¹˜í•˜ëŠ” postë¥¼ ì „ë‹¬ë°›ëŠ”ë‹¤. `useAppSelector`ëŠ” ë°˜í™˜í•˜ëŠ” ì°¸ì¡°ì˜ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ë Œë”ë§ ëœë‹¤.

```tsx
import { useParams } from 'react-router-dom';
import { useAppSelector } from 'hooks';
import PostItem from 'components/posts/PostItem';

export default function SinglePostPage() {
  const { postId } = useParams();

  const post = useAppSelector((state) =>
    state.posts.find((p) => p.id === postId),
  );

  if (!post) {
    return (
      <section>
        <h2>Post not found!</h2>
      </section>
    );
  }

  return (
    <section>
      <PostItem post={post} />
    </section>
  );
}
```

ì´ì œ `postUpdated` ë¦¬ë“€ì„œ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ì.

```ts
// features/postsSlice.ts
const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    postAdded(state, action: PayloadAction<Post>) {
      state.push(action.payload);
    },
    postUpdated(state, action: PayloadAction<Post>) {
      const { content, id, title } = action.payload;
      const existingPost = state.find((post) => post.id === id);
      if (existingPost) {
        existingPost.title = title;
        existingPost.content = content;
      }
    },
  },
});
```

`action.payload`ì—ì„œ post ì •ë³´ë¥¼ ë°›ì•„ì™€ ì¼ì¹˜í•˜ëŠ” í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì•„ ìˆ˜ì •í•œë‹¤.

### prepare

í˜„ì¬ `PostForm` ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ë””ìŠ¤íŒ¨ì¹­í•˜ê¸° ì „ì— nanoidë¥¼ ì´ìš©í•˜ì—¬ idë¥¼ ìƒì„±í•˜ê³  `postAdded` ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•œë‹¤. ë§Œì•½ ì—¬ëŸ¬ ê°œì˜ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ë™ì¼í•œ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ê±°ë‚˜ payloadì˜ ë¡œì§ì´ ë³µì¡í•˜ë‹¤ë©´ ë°˜ë³µë˜ëŠ” ì½”ë“œì˜ ì–‘ì´ ë§ì„ ê²ƒì´ë‹¤. `prepare`ë¥¼ ì´ìš©í•˜ë©´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

ì§ì ‘ `createAction`ì„ ì´ìš©í•˜ë©´ payload ë¡œì§ì„ ì§ì ‘ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ì§€ë§Œ redux toolkitì˜ `createSlice`ëŠ” ìë™ìœ¼ë¡œ action creatorë¥¼ ìƒì„±í•˜ë¯€ë¡œ `prepare`ë¥¼ ì´ìš©í•˜ì—¬ í•´ê²°í•´ì•¼ í•œë‹¤.

```js
function postAdded(title, content) {
  const id = nanoid();
  return {
    type: 'posts/postAdded',
    payload: { id, title, content },
  };
}
```

> ì•¡ì…˜ì— ê³ ìœ  id ë˜ëŠ” ì„ì˜ì˜ ê°’ì„ í¬í•¨í•´ì•¼ í•˜ëŠ” ê²½ìš° í•­ìƒ ë¨¼ì € ìƒì„±í•˜ì—¬ ì•¡ì…˜ ê°ì²´ì— ë„£ì–´ì•¼ í•œë‹¤. ë¦¬ë“€ì„œëŠ” ê²°ê³¼ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì ˆëŒ€ë¡œ ì„ì˜ì˜ ê°’ì„ ê³„ì‚°í•´ì„  ì•ˆëœë‹¤.

```ts {5-18}
const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    postAdded: {
      reducer(state, action: PayloadAction<Post>) {
        state.push(action.payload);
      },
      prepare(title, content) {
        return {
          payload: {
            id: nanoid(),
            title,
            content,
          },
        };
      },
    },
    // ì½”ë“œ ìƒëµ
  },
});
```

`prepare`ë¥¼ ì‚¬ìš©í•˜ë©´ storeì— `action.payload`ê°€ ì „ë‹¬ë˜ê¸° ì „ì—(ë¯¸ë“¤ì›¨ì–´ì™€ ê°™ì€) ì¶”ê°€ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

```tsx
// components/posts/PostForm.tsx
const handlePostSave = (e: React.FormEvent) => {
  // ì½”ë“œìƒëµ
  dispatch(postAdded(title, content));
  // ì½”ë“œìƒëµ
};
```

ì´ì œ `postAdded` ì•¡ì…˜ í•¨ìˆ˜ëŠ” 2ê°œì˜ ì¸ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.

### UsersReducer

usersSliceë¥¼ ìƒì„± í›„ ìŠ¤í† ì–´ì— ì¶”ê°€í•œë‹¤.

```ts
// features/usersSlice.ts
import { createSlice } from '@reduxjs/toolkit';

const initialState: User[] = [
  {
    id: '1',
    name: 'Leanne Graham',
  },
  {
    id: '2',
    name: 'Ervin Howell',
  },
  {
    id: '3',
    name: 'Clementine Bauch',
  },
];

const usersSlice = createSlice({
  name: 'users',
  initialState,
  reducers: {},
});

export default usersSlice.reducer;
```

```ts
// app/store.ts
import { configureStore } from '@reduxjs/toolkit';
import postsSlice from 'features/postsSlice';
import usersSlice from 'features/usersSlice';

export const store = configureStore({
  reducer: { posts: postsSlice, users: usersSlice },
});
```

ìŠ¤í† ì–´ì— ìœ ì € ìƒíƒœê°€ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ í¬ìŠ¤íŠ¸ë¥¼ ë“±ë¡í•  ë•Œ ìœ ì €ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ `postAdded` ë¦¬ë“€ì„œì— userIdë¥¼ ì¶”ê°€ì‹œí‚¨ë‹¤. `PostForm` ì»´í¬ë„ŒíŠ¸ì—ë„ userIdë¥¼ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì–‘ì‹ì„ ì¶”ê°€í•œë‹¤. ì¶”ê°€ë¡œ í¬ìŠ¤íŠ¸ ì‘ì„±ì¼ì„ í™•ì¸í•˜ê¸° ìœ„í•´ prepare í•¨ìˆ˜ì— date ì½”ë“œë¥¼ ì¶”ê°€ ì‘ì„±í•œë‹¤.

```ts {9,13,16}
const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    postAdded: {
      reducer(state, action: PayloadAction<Post>) {
        state.push(action.payload);
      },
      prepare(title, content, userId) {
        return {
          payload: {
            id: nanoid(),
            date: new Date().toISOString(),
            title,
            content,
            userId,
          },
        };
      },
    },
    // ì½”ë“œ ìƒëµ
  },
});
```

ì‚¬ìš©ìê°€ í¬ìŠ¤íŠ¸ì— ì´ëª¨í‹°ì½˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ `ReactionButtons` ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“ ë‹¤. reactionEmoji ê°ì²´ëŠ” í‚¤ì™€ ì´ëª¨ì§€ë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ë° `Object.entries` ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ ë°°ì—´ë¡œ ë³€ê²½í•˜ê³  `map` ë°˜ë³µë¬¸ì„ ëŒë ¤ buttonì„ ìƒì„±í•œë‹¤. ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ `reactionAdded` ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ê²Œ ë˜ëŠ”ë° ì´ë•Œ í•´ë‹¹ postë¥¼ ì°¾ê¸° ìœ„í•´ id ê°’ê³¼ emoji count ì¦ê°€ë¥¼ ìœ„í•´ emoji nameì„ ë„˜ê²¨ì¤€ë‹¤.

```tsx
import { reactionAdded } from 'features/postsSlice';
import { useAppDispatch } from 'hooks';

const reactionEmoji = {
  thumbsUp: 'ğŸ‘',
  hooray: 'ğŸ‰',
  heart: 'â¤ï¸',
  rocket: 'ğŸš€',
  eyes: 'ğŸ‘€',
};

export default function ReactionButtons({ post }: { post: Post }) {
  const dispatch = useAppDispatch();

  const handleReactionAdd = (name: string) => {
    dispatch(reactionAdded({ id: post.id, key: name }));
  };

  return (
    <div className="flex gap-x-2 mt-2">
      {Object.entries(reactionEmoji).map(([name, emoji]) => (
        <button
          onClick={() => handleReactionAdd(name)}
          className="border p-1 rounded"
          type="button"
          key={name}
        >
          {emoji} {post.reactions[name as keyof typeof reactionEmoji]}
        </button>
      ))}
    </div>
  );
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `reactions` ìƒìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ë”ë¯¸ ë°ì´í„°ì˜ ê°’ê³¼ prepare í•¨ìˆ˜ì— ê°ê° ì¶”ê°€í•œë‹¤. `reactionAdded` í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ payloadëŠ” idì™€ keyë¥¼ ë°›ê³  í•´ë‹¹ postë¥¼ ì°¾ì•„ ê°’ì„ ë³€ê²½í•˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

```ts {2-8,19,28,48,53-59}
// features/postsSlice.ts
const reactions = {
  eyes: 0,
  heart: 0,
  hooray: 0,
  rocket: 0,
  thumbsUp: 0,
};

const initialState: Post[] = [
  {
    id: '1',
    title:
      'sunt aut facere repellat provident occaecati excepturi optio reprehenderit',
    content:
      'quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"',
    userId: '1',
    date: sub(new Date(), { minutes: 10 }).toISOString(),
    reactions,
  },
  {
    id: '2',
    title: 'qui est esse',
    content:
      'est rerum tempore vitae\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\nqui aperiam non debitis possimus qui neque nisi nulla',
    userId: '2',
    date: sub(new Date(), { minutes: 5 }).toISOString(),
    reactions,
  },
];

const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    postAdded: {
      reducer(state, action: PayloadAction<Post>) {
        state.push(action.payload);
      },
      prepare(title, content, userId) {
        return {
          payload: {
            id: nanoid(),
            date: new Date().toISOString(),
            title,
            content,
            userId,
            reactions,
          },
        };
      },
    },
    reactionAdded(state, action: PayloadAction<{ id: string; key: string }>) {
      const { id, key } = action.payload;
      const existingPost = state.find((post) => post.id === id);
      if (existingPost) {
        existingPost.reactions[key as keyof typeof reactions] += 1;
      }
    },
    // ì½”ë“œ ìƒëµ
  },
});
```

![gif !!400](/imgs/posts/10/3d7360a7-eaef-4be9-bce2-1a2bd33510ee.gif)

#### Reference

[https://ko.redux.js.org/tutorials/essentials/part-3-data-flow !!ref](https://ko.redux.js.org/tutorials/essentials/part-3-data-flow)
[https://ko.redux.js.org/tutorials/essentials/part-4-using-data !!ref](https://ko.redux.js.org/tutorials/essentials/part-4-using-data)
